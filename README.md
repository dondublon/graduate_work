# ü•á –î–∏–ø–ª–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞. –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ê–¥—Ä–µ—Å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è https://github.com/dondublon/graduate_work .
–ü—Ä–µ–¥—ã–¥—É—â–∏–π code review —Å –Ω–∞—à–∏–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏ –∑–¥–µ—Å—å: https://github.com/dondublon/graduate_work/issues/53d

## üîÄ 1. –°—Ö–µ–º—ã
- –°—Ö–µ–º—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –æ–ø–∏—Å–∞–Ω—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ C4 - level2 –∏ level3. –ù–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –Ω–∞–∑–≤–∞–Ω–∏—è–º –≤ docker-compose.yml. –°–æ —Å—Ö–µ–º–∞–º–∏ –º–æ–∂–Ω–æ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è –≤ –ø–∞–ø–∫–µ ./schemes. 


## ‚òëÔ∏è 2.–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–ª—å–º–æ–≤ –≤ –ë–î
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è admin_panel
- `docker exec -ti admin_panel_async_api python manage.py migrate`
- `docker exec -ti auth flask db upgrade`
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —Ñ–∞–π–ª "/sqlite_to_postgres/load_data.py"

## üîê 3.–°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å —Å–∏—Å—Ç–µ–º–æ–π —Ä–æ–ª–µ–π (Auth)
–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ `http://0.0.0.0:5001/api/v1/user/`

–ö–æ–ª–ª–µ–∫—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ä—É—á–∫–∞–º–∏ –ª–µ–∂–∏—Ç –≤ –ø–∞–ø–∫–µ ./auth/auth.postman_collection.json

### –°–æ–∑–¥–∞—Ç—å —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–î–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ `auth` –∏ –≤–≤–µ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—É.
```commandline
flask create-superuser <email>
```
–ü–æ—Å–ª–µ —á–µ–≥–æ –≤–∞–º –ø—Ä–µ–¥–ª–æ–∂–∞—Ç –≤–≤–µ—Å—Ç–∏ –ø–∞—Ä–æ–ª—å, –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –µ–≥–æ. –ò—Ç–æ–≥–æ–≤—ã–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –≤–æ—Ç —Ç–∞–∫:
```commandline
(venv) developer@MacBook-Pro auth % flask --app app create-superuser ADMIN@email.com
Enter password: ADMIN
Confirm password: ADMIN
Superuser was successfully created
(venv) developer@MacBook-Pro auth % flask create-superuser ADMIN@email.com
User already exists. Try again with another email

```
### –ú–∏–≥—Ä–∞—Ü–∏–∏

–ß—Ç–æ–±—ã –Ω–∞–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É:
- `flask db upgrade` –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ;
- `docker exec -ti auth flask db upgrade` –≤ –ø–æ–¥–Ω—è—Ç–æ–º –¥–æ–∫–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ;

## üóÉ 4. –ë—ç–∫–µ–Ω–¥ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤ —Ç–æ–º —á–∏—Å–ª–µ –∞–≤–∞—Ç–∞—Ä–∫–∏, –∞ —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ, –æ—Ü–µ–Ω–æ–∫, —Ä–µ–≤—å—é –∏ –ª–∞–π–∫–æ–≤ (Backend).
–°–µ—Ä–≤–∏—Å —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É CRUD —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Ñ–∏–ª–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ö–æ–ª–ª–µ–∫—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ä—É—á–∫–∞–º–∏ –ª–µ–∂–∏—Ç –≤ –ø–∞–ø–∫–µ ./backend/backend.postman_collection.json

- –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–¥ —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å—å—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–ª–µ–¥—É—é—â–µ–µ:
1. –°–æ–∑–¥–∞—Ç—å —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–µ—Ä–≤–∏—Å–µ auth
2. –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ —Å–µ—Ä–≤–∏—Å–µ auth –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å access_token.
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ backend —Å –ø–æ–º–æ—â—å—é –∑–∞–ø—Ä–æ—Å–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä
```commandline
curl --location --request POST '127.0.0.1:8000/v1/user/register' \
--header 'user_uuid: d16b19e7-e116-43b1-a95d-cd5a11e8f1b7' \
--header 'Content-Type: application/json' \
--data-raw '{
    "email": "user000@email.com",
    "password": "user000",
    "password_confirmation": "user000",
    "first_name": "–û–ª–µ–≥",
    "family_name": "–ò–≤–∞–Ω–æ–≤",
    "father_name": "–ë–æ—Ä–∏—Å–æ–≤–∏—á",
    "phone": "+79104470000"
}'
```
3. –° –ø–æ–º–æ—â—å—é —Ä–æ–ª–∏ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–µ—Ä–≤–∏—Å–µ Auth —Å–æ–∑–¥–∞—Ç—å —Ä–æ–ª—å "Admin"
```commandline
curl --location --request POST 'http://0.0.0.0:5001/api/v1/user/roles' \
--header 'Authorization: {access_token} \
--header 'Content-Type: application/json' \
--data-raw '{"name": "Admin"}'
```
4. –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å Auth –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å access_token
```commandline
curl --location --request POST '0.0.0.0:5001/api/v1/user/login' \
--header 'Content-Type: application/json' \
--data-raw '{"email": "user000@email.com", "password": "user000"}'
```
5. –£–∑–Ω–∞—Ç—å user_id –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏—Å–ø–æ–ª—å–∑—É—è –º–µ—Ç–æ–¥ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ª–∏—á–Ω–æ–º –ø—Ä–æ—Ñ–∏–ª–µ. –¢–æ–∫–µ–Ω –≤–∑—è—Ç—å –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞.
```commandline
curl --location --request GET '127.0.0.1:8000/v1/user/get-profile' \
--header 'Authorization: Bearer {access_token}' \
--data-raw ''
```
6. –ü—Ä–∏—Å–≤–æ–∏—Ç—å –Ω–æ–≤–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ user_id —Ä–æ–ª—å admin, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ–∫–µ–Ω —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```commandline
curl --location --request POST 'http://0.0.0.0:5001/api/v1/user/user-role' \
--header 'Authorization: Bearer {access_token}' \
--header 'Content-Type: application/json' \
--data-raw '{
    "user_id": "6a1385cb-c0b8-4fd3-884c-d3399bd9c98e",
    "role_id": "d2bb61f5-a681-4b25-8961-1a3d1a3ad3e1"
}'
```
7. –¢–µ–ø–µ—Ä—å –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–æ–º –∏ –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ –ø—Ä–æ—Ñ–∏–ª–∏. –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä user_id —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º ["*"] –í –º–µ—Ç–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏—è. 
```commandline
curl --location --request GET '127.0.0.1:8000/v1/user/profiles?page=1&size=4' \
--header 'Content-Type: application/json' \
--data-raw '{   
    "email": "user555@email.com",
    "password": "user000",
    "users_id": ["*"]
}'
```

## üôç‚Äç‚ôÇÔ∏è 5.–°–µ—Ä–≤–∏—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π (Profiles)
–°–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é gRPC. 

–§–∞–π–ª—ã –≤ ./profiles/src/grpc_files –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∞–π–ª–∞ ./profiles/protos/profiles.proto. 

–ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å ./profiles/protos/profiles.proto, —Ç–æ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –∑–∞–Ω–æ–≤–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –≤ ./profiles/src/grpc_files. –î–ª—è —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç update_protos.sh

–°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –µ—Å–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è **RUN_MODE** –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ **ASYNC**. 

–õ–æ–≥–∏–∫—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ —Ñ–∞–π–ª–µ ./profiles/src/entrypoint.sh

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ñ–∞–π–ª–æ–º ./profiles/src/profiles_client_sample.py. 

–¢–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–µ—Å—Ç—ã –≤ –ø–∞–ø–∫–µ ./profiles/tests

## 6. –°–µ—Ä–≤–∏—Å UGC (–ª–∞–π–∫–∏, —Ä–µ—Ü–µ–Ω–∑–∏–∏ –∏ —Ç. –¥.)
–ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω user id, —Ç–æ –æ–Ω –±–µ—Ä—ë—Ç—Å—è –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. 

1. –î–æ–±–∞–≤–∏—Ç—å –ª–∞–π–∫ –∫ —Ñ–∏–ª—å–º—É
```commandline
curl --request POST '127.0.0.1:8000/v1/likes/add' \
--header 'Content-Type: application/json' \
--data-raw '{   
    "movie": "803c794c-ddf0-482d-b2c2-6fa92da4c5e2",
    "value": 5
}'
```

2. –£–¥–∞–ª–∏—Ç—å –ª–∞–π–∫ –∫ —Ñ–∏–ª—å–º—É
```commandline
curl --request DELETE '127.0.0.1:8000/v1/likes/remove' \
--header 'Content-Type: application/json' \
--data-raw '{   
    "id": "803c794c-ddf0-482d-b2c2-6fa92da4c5e2"
}'
```
id = movie id. 

3. –ü–æ—Å—á–∏—Ç–∞—Ç—å –ª–∞–π–∫–∏ –∫ —Ñ–∏–ª—å–º—É
```commandline
curl --request GET '127.0.0.1:8000/v1/likes/count' \
--header 'Content-Type: application/json' \
--data-raw '{   
    "id": "803c794c-ddf0-482d-b2c2-6fa92da4c5e2"
}'
```

4. –î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é –∫ —Ñ–∏–ª—å–º—É
```commandline
curl --request POST '127.0.0.1:8000/v1/likes/count' \
--header 'Content-Type: application/json' \
--data-raw '{   
    "movie": "803c794c-ddf0-482d-b2c2-6fa92da4c5e2",
    "text" : "......"
}'
```

5. –£–¥–∞–ª–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é –∫ —Ñ–∏–ª—å–º—É
```commandline
curl --request DELETE '127.0.0.1:8000/v1/likes/count' \
--header 'Content-Type: application/json' \
--data-raw '{   
    "id": "53954284-caaf-4248-b0e7-fd1265499a91"
}'
```

6. –ü–æ–ª—É—á–∏—Ç—å —Ä–µ—Ü–µ–Ω–∑–∏—é –∫ —Ñ–∏–ª—å–º—É
–ë–µ—Ä—ë—Ç—Å—è –ø–æ user id –∏–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
```commandline
curl --request GET '127.0.0.1:8000/v1/reviews/get' \
--header 'Content-Type: application/json' \
--data-raw '{   
    "id": "803c794c-ddf0-482d-b2c2-6fa92da4c5e2"
}'
```

7. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–µ—Ü–µ–Ω–∑–∏–π –∫ —Ñ–∏–ª—å–º—É
```commandline
curl --request GET '127.0.0.1:8000/v1/reviews/list' \
--header 'Content-Type: application/json' \
--data-raw '{   
    "id": "803c794c-ddf0-482d-b2c2-6fa92da4c5e2"
}'
```

8. –î–æ–±–∞–≤–∏—Ç—å –ª–∞–π–∫ –∫ —Ä–µ—Ü–µ–Ω–∑–∏–∏
```commandline
curl --request POST '127.0.0.1:8000/v1/review_likes/add' \
--header 'Content-Type: application/json' \
--data-raw '{   
    "review": "63ff480aa96c3ea499bc01242",
    "movie":  "803c794c-ddf0-482d-b2c2-6fa92da4c5e2",
    "review_author_id": "d96f4d59-12d4-419c-967d-fd62c41cc6b0",
    "value": 5
}'
```
9. –£–¥–∞–ª–∏—Ç—å –ª–∞–π–∫ –∫ —Ä–µ—Ü–µ–Ω–∑–∏–∏
```commandline
curl --request DELETE '127.0.0.1:8000/v1/review_likes/remove' \
--header 'Content-Type: application/json' \
--data-raw '{   
    "id": "620934552b431a95fdcd7c7ca"
}'
```

10. –ü–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤ –∫ —Ä–µ—Ü–µ–Ω–∑–∏–∏
```commandline
curl --request GET '127.0.0.1:8000/v1/review_likes/count' \
--header 'Content-Type: application/json' \
--data-raw '{   
    "id": "63ff480aa96c3ea499bc01242"
}'
```

11. –î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–ª–∞–¥–∫—É
```commandline
curl --request POST '127.0.0.1:8000/v1/bookmarks/add' \
--header 'Content-Type: application/json' \
--data-raw '{   
    "movie": "803c794c-ddf0-482d-b2c2-6fa92da4c5e2"
}'
```

12. –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–ª–∞–¥–∫—É
```commandline
curl --request DELETE '127.0.0.1:8000/v1/bookmarks/remove' \
--header 'Content-Type: application/json' \
--data-raw '{   
    "movie": "803c794c-ddf0-482d-b2c2-6fa92da4c5e2"
}'
```

13. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–∫–ª–∞–¥–æ–∫
```commandline
curl --request POST '127.0.0.1:8000/v1/bookmarks/list' \
--header 'Content-Type: application/json' \
--data-raw '{   
    "movie": "803c794c-ddf0-482d-b2c2-6fa92da4c5e2"
}'
```



